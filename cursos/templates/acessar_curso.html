{% extends 'base.html' %}

{% block title %}{{ curso.titulo }} - Acessar Curso{% endblock %}

{% block content %}
<h2>{{ curso.titulo }}</h2>

<p><strong>Descrição:</strong> {{ curso.descricao }}</p>
<p><strong>Categoria:</strong> {{ curso.categoria.nome }}</p>
<p><strong>Instrutores:</strong></p>
<ul>
  {% for instrutor in curso.instrutores.all %}
    <li>{{ instrutor.nome|title }}</li>
  {% empty %}
    <li>Sem instrutores cadastrados.</li>
  {% endfor %}
</ul>

{% if inscricao %}
  {% if inscricao.ativa %}
    <p style="margin:8px 0;">
      Acesso válido até <strong>{{ inscricao.expira_em|date:"d/m/Y" }}</strong>
      ({{ inscricao.dias_restantes }} dias restantes).
    </p>
  {% else %}
    <div class="alerta">
      Seu acesso está expirado.
    </div>
  {% endif %}
{% endif %}

<hr>
<h3>Conteúdo do Curso</h3>
{% if curso.video_id %}
  <div class="video-wrapper" style="margin:16px 0;">
    <iframe width="560" height="315"
            src="https://www.youtube.com/embed/{{ curso.video_id }}"
            title="YouTube video player"
            frameborder="0"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
            allowfullscreen></iframe>
  </div>
  <a href="https://youtu.be/{{ curso.video_id }}" target="_blank" rel="noopener" class="btn btn-azul">
    Assistir no YouTube
  </a>
{% endif %}

{% if curso.material_pdf %}
  <a href="{% url 'baixar_material_curso' curso.pk %}" 
     class="btn btn-azul" style="margin-left:8px;">
     Baixar material (PDF)
  </a>
{% endif %}

{% if inscricao and inscricao.ativa %}
  <form method="post"
        action="{% url 'concluir_curso' curso.pk %}" 
        class="linha-concluir">
    {% csrf_token %}
    <label class="check-concluir">
      <input type="checkbox" 
             name="concluido"
             {% if inscricao.concluido %}checked{% endif %}
             onchange="this.form.submit()">
      Marcar como concluído
    </label>
  </form>

  {% if inscricao.concluido %}
    <a href="{% url 'certificado_curso' curso.pk %}"
       class="btn btn-azul">
       Baixar certificado (PDF)
    </a>
  {% endif %}
{% endif %}

<a href="{% url 'index' %}" class="btn btn-azul" style="margin-top:12px;">Voltar</a>
{% endblock %}